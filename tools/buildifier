#!/bin/bash

# Determine OS type
OS="$(uname -s)"
case "$OS" in
    Linux)
        OS="linux"
        ;;
    Darwin)
        OS="darwin"
        ;;
    *)
        echo "Unsupported operating system: $OS"
        exit 1
        ;;
esac

# Determine architecture
ARCH="$(uname -m)"
case "$ARCH" in
    x86_64)
        ARCH="amd64"
        ;;
    arm64|aarch64)
        ARCH="arm64"
        ;;
    *)
        echo "Unsupported architecture: $ARCH"
        exit 1
        ;;
esac

# Construct the path to the Buildifier binary
DIRNAME=$(dirname $(readlink -f "$0"))
BUILDIFIER_BINARY="${DIRNAME}/../.github/buildifier/buildifier-${OS}-${ARCH}"

# Check if the binary exists
if [ ! -x "$BUILDIFIER_BINARY" ]; then
    echo "Buildifier binary not found or not executable: $BUILDIFIER_BINARY"
    exit 1
fi

# Run the Buildifier binary
exec "$BUILDIFIER_BINARY" "$@"
